#!/usr/bin/env bash
echo '      ____              __        '
echo '     / __ \   ____ _   / /      ___ '
echo '    / / / /  / __ `/  / /      / _ \'
echo '   / /_/ /  / /_/ /  / /___   /  __/'
echo '  /_____/   \__,_/  /_____/   \___/ '
echo ''
echo '    +-+-+-+-+-+-+-+-+-+-+ +-+-+-+'
echo '    |L|i|n|u|x|s|h|e|l|l| |C|L|I|'
echo '    +-+-+-+-+-+-+-+-+-+-+ +-+-+-+'
echo ''
echo '  >> Author : David Lejeune'
echo "  >> Created : 24/08/2017"
echo ''
echo ' ###################################'
echo ' #     REMOTE AGENT SETUP LINUX    #'
echo ' ###################################'
echo ''


echo "--------------------------------------------------------------"
echo " INSTALLING GIT"
echo "--------------------------------------------------------------"
sudo apt-get install git


echo "--------------------------------------------------------------"
echo " INSTALLING JDK"
echo "--------------------------------------------------------------"
echo "See git repo oraclejdk-arm"
# sudo apt-get install openjdk-8-jre-headless
# echo $JAVA_HOME
# if [ ${#JAVA_HOME} -le 1 ]; then
# 	echo "JAVA_HOME not found" ;
# 	echo "export JAVA_HOME=/usr/bin/java" | sudo tee --append /etc/profile
# 	echo "export PATH=$JAVA_HOME/bin:$PATH" | sudo tee --append /etc/profile
#
# else
# 	echo "JAVA_HOME exists already"
# fi
# sudo apt-get update
# sudo add-apt-repository ppa:webupd8team/java -y
# sudo apt-get update
# sudo apt-get install oracle-java8-installer -y
# #manually accept the license agreement
# sudo echo 'JAVA_HOME="/usr/lib/jvm/java-8-oracle/jre"' >> /etc/environment
# sudo update-alternatives --config javac
# sudo update-alternatives --config java

git clone git@github.com:DavidLejeune/oraclejavajdk-arm.git
chmod u+x ./oraclejavajdk-arm/install-jdk-arm
./oraclejavajdk-arm/install-jdk-arm


echo "--------------------------------------------------------------"
echo " INSTALLING ANT"
echo "--------------------------------------------------------------"
sudo apt-get install ant
echo $ANT_HOME
if [ ${#ANT_HOME} -le 1 ]; then
	echo "ANT_HOME not found" ;
	echo "export ANT_HOME=/usr/bin/ant" | sudo tee --append /etc/profile
	echo "export PATH=$ANT_HOME:$PATH" | sudo tee --append /etc/profile

else
	echo "ANT_HOME exists already"
fi


echo "--------------------------------------------------------------"
echo " RUNNING BAMBOO JVM"
echo "--------------------------------------------------------------"
url="http://84.199.251.203/agentServer/agentInstaller/atlassian-bamboo-agent-installer-6.0.2.jar"
rm -f atlassian-bamboo-agent-installer-6.0.2.jar
wget $url
java -Dbamboo.Home=/home/pi/bamboo-agent-home -jar atlassian-bamboo-agent-installer-6.0.2.jar http://84.199.251.203/agentServer/
#java -jar atlassian-bamboo-agent-installer-6.0.2.jar http://84.199.251.203/agentServer/
